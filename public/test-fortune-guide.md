# 签文代入测试指南

## 🎯 测试目标

验证 AI 是否在对话中正确代入今日签文。

## 📋 测试步骤

### 步骤 1: 清除抽签记录

访问：`http://localhost:3000/test-fortune.html`

点击"🗑️ 清除抽签记录"按钮。

### 步骤 2: 重新抽签

自动跳转到首页后，完成抽签流程。

### 步骤 3: 开始对话

点击"开始今天的对话"，应该会自动跳转到 `/chat?fromFortune=true`

### 步骤 4: 观察控制台日志

**🔥 重要：打开浏览器开发者工具（F12），查看 Console 标签！**

你应该看到类似这样的日志：

```
📜 今日签文: 流水不争先 - 流水不争先，争的是滔滔不绝
🎯 是否代入签文: true 原因: 已匹配或随机通过
✨ 签文系统提示词已生成，长度: XXX
```

### 步骤 5: 查看 AI 回复

AI 应该会自动发送第一条消息，内容类似：

```
早上好！今天抽到"流水不争先"这支签，特别喜欢这个意境呢。

流水不争先，争的是滔滔不绝 - 意思是说，持续比一时的速度更重要。

今天想聊点什么？我随时在这里陪伴你 💝
```

---

## 🔧 如果没有自动回复

### 方案 A: 手动发送测试消息

在聊天输入框输入：
- "你好"
- "今天感觉怎么样"

然后查看控制台日志和 AI 回复。

### 方案 B: 查看服务器日志

在服务器终端查看完整的日志输出。

### 方案 C: 检查签文数据

在浏览器控制台运行：

```javascript
fetch('/api/fortune/today')
  .then(r => r.json())
  .then(data => console.log('今日签文数据:', data))
```

---

## 📊 预期结果

### ✅ 成功的标志

1. 控制台显示 `📜 今日签文: ...`
2. 控制台显示 `🎯 是否代入签文: true`
3. AI 回复中提及签文内容
4. 签文融入自然，不生硬

### ❌ 失败的可能原因

1. **没有获取到签文**：控制台显示 `📜 今日签文: 无`
2. **概率未触发**：控制台显示 `🎲 签文随机概率: 不代入`
3. **API 错误**：控制台显示错误信息
4. **LLM 未处理提示词**：AI 忽略了 system prompt

---

## 🐛 调试技巧

### 查看完整的签文数据

```javascript
fetch('/api/fortune/today')
  .then(r => r.json())
  .then(data => {
    console.log('完整签文数据:', JSON.stringify(data, null, 2));
  });
```

### 检查 LLM 提供商

确认当前使用的 LLM 提供商（智谱 AI 或 OpenAI）是否支持自定义 system prompt。

### 测试不同的消息

尝试发送包含关键词的消息：
- "今天感觉很焦虑"
- "工作压力太大了"
- "遇到了一些困难"

这些消息更容易触发签文代入（关键词匹配）。
